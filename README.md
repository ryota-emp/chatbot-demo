# 0. 本課題について

本課題では、LLM のアプリ開発を行なっていただきます。
実装においては、Chainlit というライブラリを使用します。

> Chainlit とは？
>
> - Python のオープンソースのライブラリ
> - ChatGPT のような UI のアプリを、短いコードで作成し、デプロイできる
> - 「chainlit」で検索すれば多くの日本語記事が出てくる
> - 公式レポジトリ：https://github.com/Chainlit/chainlit

みなさんには、アプリで追加したい機能に関するイシューを 4 つ立ててもらい、そのイシューを 1 つずつ解決していくことで、 LLM アプリの機能追加を行なっていただきます。

> 作成するイシューの例
> ![alt text](resource/fig/github_イシューの例.png)

このフローに沿って開発することで、ツールの使い方や開発の流れの理解し、1 人のエンジニアとして活躍できるスキルの基礎を身につけて行きます。

<details>
<summary>最終制作物のイメージ（動画）</summary>

![alt text](resource/movie/readme_part4制作物.gif)

</details>

<details>
<summary>最終制作物のイメージ（画像）</summary>

![alt text](resource/movie/readme_part4制作物_画像.png)

</details>

---

本講義で使うツールは、以下の通りです。

- Docker（見出し 1 で説明）
  - 仮想化プラットフォーム。自分のローカルの PC 環境を汚さずに環境を構築できる
- VSCode（見出し 2 で説明）
  - 多くの開発者が使う、コードを書く環境（IDE；総合開発環境）
- Devcontainer（見出し 2 で説明）
  - VSCode 上で Docker を簡単に使うためのツール

以下の手順に従って、開発環境を用意しましょう！

# 1. Docker Desktop のインストール
まず、Dockerについて理解する前に、Downloadをしましょう。ご自身のOSにあった、ダウンロードのリンクが出てくると思うので、ダウンロードしてみてください。
- (https://www.docker.com/products/docker-desktop/)

## Dockerってなに？
Docker は、**アプリケーションをどのパソコンでも同じように動かせるようにする技術**です。例えば、みなさんが使っているパソコンのOSが違ったり（Windows や Macなど）、OSのバージョンが異なっていたとしても、Docker を使うとその違いを気にせずにアプリケーションを開発したり実行したりできます。

Docker を使えば、「開発したアプリが自分のパソコンでは動いたのに、別のパソコンやサーバーではうまく動かない」というトラブルを防げます。**どんな環境でも同じようにアプリが動く**というのが Docker の大きな特徴です。

### どうして環境が違っても同じように動くの？

Docker では、**コンテナ** という「箱」の中にアプリケーションをまとめます。この「箱」の中には、アプリを動かすために必要な **プログラムのコード** や **ライブラリ**（他のプログラムや部品）、**設定ファイル** などがすべて含まれています。この「箱」を持ち運ぶことで、どのパソコンやサーバーでも同じようにアプリが動きます。

お弁当に例えてみると、
- コンテナ：お弁当箱
→ コンテナは、お弁当箱そのもの。お弁当箱には、必要な食材（ご飯、主菜、副菜など）がきちんとパッケージされています。持ち運んで、どこで食べても同じお弁当が食べられるのが特徴です。
- アプリケーション：お弁当の中身（ご飯、主菜、副菜）
→ アプリケーションは、お弁当の中に詰まっている料理です。お弁当箱（コンテナ）に入っているので、どこで食べても中身は同じで、バラバラになることもありません。
- ライブラリ：食材や調味料
→ ライブラリは、食材や調味料。アプリケーション（食事）をしっかりと「完成させるため」に必要な材料です。これがなければ、アプリ（食事）として機能しません。
- 設定ファイル：食べる時の手順やマニュアル
→ 設定ファイルは、どうやって食べるかの指示書のようなもの。たとえば、お弁当には温めて食べるものや、そのまま食べるものがありますが、そういった「手順」が設定ファイルに相当します。これを守れば、どこででも同じ食事ができます。
- ホストOS：食べる場所（公園、オフィス、家など）
→ ホストOSは、お弁当を食べる場所です。オフィス、公園、家など、どこで食べても、お弁当箱（コンテナ）の中身は変わらず、同じ料理が楽しめます。つまり、環境に依存せずに動作するDockerの特徴と同じです。
- Docker：お弁当を作る仕組みやツール
→ Dockerは、お弁当を作るプロセス全体を担当します。お弁当箱にしっかりと詰めることで、持ち運びが簡単になり、どこででも同じ食事ができるようになる仕組みを提供しています。

### コンテナがどう便利なのか？

従来、開発者のパソコン（開発環境）と、実際にアプリケーションを動かすサーバー（本番環境）の間には、環境の違いによって動作に問題が生じることがよくありました。たとえば、開発環境ではうまく動いていたのに、本番環境では動かないというトラブルです。

これは、環境ごとに設定やインストールされているソフトウェアやライブラリが異なることが原因です。しかし、コンテナを使えば、環境の違いを気にする必要がなくなります。なぜなら、コンテナの中には、アプリケーションの実行に必要なすべての環境がパッケージ化されているからです。どのコンピュータで実行しても、同じように動作することが保証されます。

### コンテナと仮想マシンの違いは？

**コンテナ** と **仮想マシン** は似た目的を持っていますが、以下の違いがあります：

- **仮想マシン (VM)**：仮想マシンは、ホストOS（元のOS）の上にもう一つのOSをまるごと動かす仕組みです。そのため、OS自体が含まれるので、サイズが大きく、起動に時間がかかることがあります。
  - 例えば、Mac上でWindowsを動かすようなものです。

- **コンテナ**：コンテナはホストOSの一部を共有しながら、アプリケーションの実行に必要な環境 **だけ** をまとめてパッケージ化します。これにより、サイズが小さく、軽量で高速に動作します。
  - そのため、コンテナはリソースの効率が良く、短時間で起動できるため、開発や運用において非常に便利です。

---

### Docker の利点は？

Docker を使うと、次のような良いことがあります：

- **動作環境が同じになる**：開発者が使っているパソコンと、実際にアプリケーションを動かすサーバーの環境が違っても、Docker を使うことで、どこでも同じようにアプリケーションが動きます。つまり、「自分のパソコンでは動いたのに、他の場所では動かない」という問題がなくなります。

- **簡単にアプリを他の場所で動かせる**：通常、アプリケーションを別の場所で動かすためには、たくさんの設定や準備が必要です。ですが、Docker を使うと、アプリをまとめた「箱」（コンテナ）をそのまま別の場所に持っていけば、設定なしで動かすことができます。これが「デプロイ」という作業ですが、難しいことを気にせず簡単にできるというのが Docker の強みです。（コンビニ弁当の味は、同じ種類なら一緒なので、すぐに安心して食べられるといった感じ）

- **軽くてすぐに動く**：仮想マシンという仕組みと比べて、Docker コンテナはとても軽いので、すぐに起動したり止めたりすることができます。これにより、開発者がアプリを試したり修正したりするスピードが速くなり、効率が上がります。

### Docker Desktop とは？

Docker Desktop は、**Windows や Mac などのデスクトップ環境で Docker を簡単に使うためのアプリケーション**です。

Docker Desktop をインストールすることで、GUI（グラフィカルユーザーインターフェース）を使って Docker を設定できます。これにより、Docker の学習や利用がスムーズに始められます。

---

### インストール方法の参考リンク

- [【入門】Docker Desktop とは何ができるの？インストールと使い方](https://www.kagoya.jp/howto/cloud/container/dockerdesktop/)
- [Windows 11 に Docker Desktop を入れる手順（令和 5 年最新版）](https://qiita.com/zembutsu/items/a98f6f25ef47c04893b3)
- [Docker for Mac をインストールする方法は？導入手順や使い方を初心者向けに解説](https://www.kagoya.jp/howto/cloud/container/dockerformac/)


# 2. VSCode の準備

## 2.1. VSCode のインストール

Visual Studio Code（VSCode）は、Microsoft が開発した無料でオープンソースのコードエディタです。軽量でありながら強力な機能を備えており、Windows、Mac、Linux の各プラットフォームに対応しています。プログラミング言語やフレームワークに依存しない汎用性の高さ、開発を円滑にする拡張機能や git 連携により、世界中の開発者に広く利用されています。

> 参考記事
>
> - [Visual Studio Code のダウンロードとインストール | javadrive](https://www.javadrive.jp/vscode/install/index1.html)
> - [MacOS で Visual Studio Code をインストールする手順 | Qiita](https://qiita.com/watamura/items/51c70fbb848e5f956fd6)

## 2.2. devcontainer のインストール・使い方

DevContainer は、VSCode の Remote - Containers 拡張機能を通じて、Docker コンテナ内で開発環境を構築し、利用するための機能です。

DevContainer の利用により、開発環境のセットアップ時間が大幅に短縮されます。また、プロジェクトに参加する全員が同じ開発環境を共有するため、環境差異によるトラブルを防ぐことができます。さらに、Docker コンテナを使用するため、開発環境を簡単に再現、共有、移行することが可能となります。これにより、環境構築の複雑さを意識することなく、コーディングに集中することができます。

DevContainer は、VSCode の拡張機能（2x2 のマスで右上だけ浮いているようなアイコン）からインストールできます

> ![alt text](resource/fig/vscode_devcontainerインストール.png)

> 参考記事
>
> - [VSCode Dev Containers でこれからの開発環境構築](https://cloudsmith.co.jp/blog/virtualhost/docker/2023/05/2381142.html)
> - [VS Code+DevContainer+Docker で最強 Python 開発環境](https://zenn.dev/aidemy/articles/vscode-env-python)

# 3. 本課題でコードを書くまで

### 1. 今見ているページをローカルの適当な場所に git clone する

```sh
git clone https://github.com/matsuoinstitute/chatbot-demo
```

### 2. VSCode にて、clone してできた chatbot-demo フォルダを選択

> ![alt text](resource/fig/vscode_フォルダ選択.png)

### 3. env ファイルの設定

env.sample をコピー＆ペーストして、作成できたファイルを「.env」という名前に変更

> 以下のような構造になっていれば OK です

> ![alt text](resource/fig/vscode_env.png)

.env ファイルには、「sk-」から始まる自分の OpenAI API キーを設定します。（step1 にて使用）

### 4. 右下に出てくる、「コンテナを再度開く」ボタンを押す

> ボタンが出てこない場合は、コマンドパレット（⌘+shift+p）を開けば、コンテナを開くボタンが出現します

> ![alt text](resource/fig/vscode_コマンドパレットでコンテナを再度開く.png)

---

これで、コードを書ける環境ができたはずです。

Github のイシューの切り方や、PR（プルリクエスト）の作り方など、具体的な開発手順は [wiki](https://github.com/matsuoinstitute/chatbot-demo/wiki) に記載しているので、そちらも併せてご覧ください。

まずは、src 直下に移動して、demo.py を動かしてみましょう！

```py
# src直下に移動
cd src
```

```sh
# demo.pyを実行
chainlit run demo.py -w
```
